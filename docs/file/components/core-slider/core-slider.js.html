<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">components/core-slider/core-slider.js | thanos</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Team 05 code repo"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="thanos"><meta property="twitter:description" content="Team 05 code repo"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/ucsd-cse112/thanO5"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">components/core-slider/core-slider.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import uuid from &apos;uuid/v1&apos;;
import templateString from &apos;./core-slider.html&apos;;
import styleString from &apos;./core-slider.css&apos;;
import &apos;../core-button/core-button&apos;;
import &apos;../core-modal/core-modal&apos;;

// Create template element
const template = document.createElement(&apos;template&apos;);
template.innerHTML = templateString;

// Create style element
const style = document.createElement(&apos;style&apos;);
style.innerHTML = styleString;

/**
 * ImageSlider Class
 */
class coreSlider extends HTMLElement {
  /**
   * constructor
   */
  constructor() {
    super();
    // Set the default prop values
    this._index = 0;
    this._controlInitialized = false;

    // Create the shadow dom
    const shadowRoot = this.attachShadow({mode: &apos;open&apos;});
    shadowRoot.appendChild(template.content.cloneNode(true));
    shadowRoot.appendChild(style.cloneNode(true));

    // Store slider link
    this._slider = this.shadowRoot.getElementById(&apos;slider&apos;);
  }

  /**
   * _handleLongText
   */
  _handleLongText() {
    const content = this._content.innerHTML;
    const title = this._title.innerHTML;
    const size = this.getAttribute(&apos;size&apos;);
    const theme = this.getAttribute(&apos;theme&apos;);
    const themeScale = theme === &apos;circle&apos; ? 0.5 : 1;

    let needHide = false;
    let buttonSize;

    switch (size) {
      case &apos;small&apos;: {
        const limit = 30;
        buttonSize = &apos;tiny&apos;;
        if (content.length &gt; limit * themeScale) {
          this._content.innerHTML = content.substring(0, limit) + &apos;...&apos;;
          needHide = true;
        }
        break;
      }

      case &apos;medium&apos;: {
        const limit = 80;
        buttonSize = theme === &apos;circle&apos; ? &apos;tiny&apos; : &apos;xsmall&apos;;
        if (content.length &gt; limit * themeScale) {
          this._content.innerHTML = content.substring(0, limit) + &apos;...&apos;;
          needHide = true;
        }
        break;
      }

      case &apos;large&apos;: {
        const limit = 200;
        buttonSize = theme === &apos;circle&apos; ? &apos;xsmall&apos; : &apos;small&apos;;
        if (content.length &gt; limit * themeScale) {
          this._content.innerHTML = content.substring(0, limit) + &apos;...&apos;;
          needHide = true;
        }
        break;
      }

      default: break;
    }

    if (needHide) {
      this._hideContent(buttonSize, theme, title, content);
    }
  }

  /**
   * _hideContent
   * @param {*} buttonSize
   * @param {*} theme
   * @param {*} title
   * @param {*} content
   */
  _hideContent(buttonSize, theme, title, content) {
    // generate a modal name
    const id = uuid();

    // create a button linked to the modal
    const button = document.createElement(&apos;core-button&apos;);
    button.setAttribute(&apos;rounded&apos;, true);
    button.setAttribute(&apos;size&apos;, buttonSize);
    // button.setAttribute(&apos;theme&apos;, &apos;standard&apos;);
    button.setAttribute(&apos;color&apos;, &apos;secondary&apos;);
    button.setAttribute(&apos;modal&apos;, id);

    if (theme !== &apos;circle&apos;) {
      button.setAttribute(&apos;style&apos;, &apos;float: right; margin: 10px 20px;&apos;);
    } else {
      button.setAttribute(&apos;style&apos;, &apos;margin: 20px 20px;&apos;);
      this._content.style[&apos;align-items&apos;] = &apos;center&apos;;
    }

    button.innerHTML = &apos;Read more&apos;;
    this._content.appendChild(button);

    // create a modal to show all description
    const modal = document.createElement(&apos;core-modal&apos;);
    modal.setAttribute(&apos;name&apos;, id);
    modal.innerHTML = `
      &lt;h1 slot=&quot;header&quot;&gt;${title}&lt;/h1&gt;
      &lt;p&gt;${content}&lt;/p&gt;
    `;
    document.body.appendChild(modal);
  }

  /**
   * observedAttributes getter
   */
  static get observedAttributes() {
    return [
      &apos;time&apos;,
      &apos;size&apos;,
      &apos;theme&apos;,
      &apos;shadow&apos;,
      &apos;text&apos;,
      &apos;control&apos;,
    ];
  }

  /**
   * size setter
   * @param {*} val
   */
  set size(val) {
    if (val) {
      this.setAttribute(&apos;size&apos;, val);
    } else {
      this.removeAttribute(&apos;size&apos;);
    }
  }

  /**
   * theme setter
   * @param {*} val
   */
  set theme(val) {
    if (val) {
      this.setAttribute(&apos;theme&apos;, val);
    } else {
      this.removeAttribute(&apos;theme&apos;);
    }
  }

  /**
   * shadow setter
   * @param {*} val
   */
  set shadow(val) {
    if (val === true) {
      this.setAttribute(&apos;shadow&apos;, &apos;&apos;);
    } else {
      this.removeAttribute(&apos;shadow&apos;);
    }
  }

  /**
   * text setter
   * @param {*} val
   */
  set text(val) {
    if (val === true) {
      this.setAttribute(&apos;text&apos;, &apos;&apos;);
    } else {
      this.removeAttribute(&apos;text&apos;);
    }
  }

  /**
   * control setter
   * @param {*} val
   */
  set control(val) {
    if (val === true) {
      this.setAttribute(&apos;control&apos;, &apos;&apos;);
    } else {
      this.removeAttribute(&apos;control&apos;);
    }
  }

  /**
   * size getter
   */
  get size() {
    return this.getAttribute(&apos;size&apos;);
  }

  /**
   * theme getter
   */
  get theme() {
    return this.getAttribute(&apos;theme&apos;);
  }

  /**
   * shadow getter
   */
  get shadow() {
    return this.getAttribute(&apos;shadow&apos;) === &apos;&apos;;
  }

  /**
   * text getter
   */
  get text() {
    return this.getAttribute(&apos;text&apos;) === &apos;&apos;;
  }

  /**
   * control getter
   */
  get control() {
    return this.getAttribute(&apos;control&apos;) === &apos;&apos;;
  }

  /**
   * connectedCallback
   */
  connectedCallback() {
    // Find all image children
    this._imageChildren = this.getElementsByTagName(&apos;img&apos;);
    this._imageChildCount = this._imageChildren.length;

    // change to setInterval to avoid recursion
    this._start(0);
  }

  /**
   * Initialize control
   */
  _initControl() {
    // Find all image children
    this._imageChildren = this.getElementsByTagName(&apos;img&apos;);
    this._imageChildCount = this._imageChildren.length;

    // Initialize menu
    this._initMenu();

    // Initialize arrows
    this._initArrows();
  }

  /**
   * _initMenu()
   */
  _initMenu() {
    let menuHTML = &apos;&apos;;

    for (let i = 0; i &lt; this._imageChildCount; i ++) {
      menuHTML += `&lt;div index=${i} class=&quot;menu-item&quot;&gt;&lt;/div&gt;`;
    }

    const menu = document.createElement(&apos;div&apos;);
    menu.setAttribute(&apos;id&apos;, &apos;menu&apos;);
    menu.innerHTML = menuHTML;

    Array.from(menu.children).forEach((child) =&gt; {
      child.addEventListener(&apos;click&apos;, () =&gt; {
        this._start(child.getAttribute(&apos;index&apos;));
      });
    });

    this._menuItems = Array.from(menu.children);
    this._menu = menu;
  }

  /**
   * _initArrows()
   */
  _initArrows() {
    const leftArrow = document.createElement(&apos;div&apos;);
    const rightArrow = document.createElement(&apos;div&apos;);

    leftArrow.setAttribute(&apos;id&apos;, &apos;left-arrow&apos;);
    leftArrow.classList.add(&apos;arrow&apos;);

    rightArrow.setAttribute(&apos;id&apos;, &apos;right-arrow&apos;);
    rightArrow.classList.add(&apos;arrow&apos;);

    leftArrow.addEventListener(&apos;click&apos;, () =&gt; {
      this.index -= 1;
      this._start(this.index);
    });

    rightArrow.addEventListener(&apos;click&apos;, () =&gt; {
      this.index += 1;
      this._start(this.index);
    });
    this._leftArrow = leftArrow;
    this._rightArrow = rightArrow;
  }

  /**
   * attributeChangedCallback
   * @param {*} attr
   * @param {*} oldV
   * @param {*} newV
   */
  attributeChangedCallback(attr, oldV, newV) {
    switch (attr) {
      case &apos;time&apos;: {
        this._slider.style.transitionDuration = newV;
        break;
      }

      case &apos;control&apos;: {
        this._setUpControl(oldV);
      }

      case &apos;text&apos;: {
        // Set up read more button;
        if (this.text &amp;&amp; this._title === undefined &amp;&amp; this._content === undefined) {
          this._title = this.querySelector(&apos;[slot=&quot;title&quot;]&apos;);
          this._content = this.querySelector(&apos;[slot=&quot;content&quot;]&apos;);

          if (this.text &amp;&amp; this._title !== null &amp;&amp; this._content !== null) {
            this._handleLongText();
          }
        }
      }

      default: break;
    }
  }

  /**
   * time getter
   */
  get time() {
    return this.getAttribute(&apos;time&apos;) || &apos;2s&apos;;
  }

  /**
   * time setter
   * @param {*} val
   */
  set time(val) {
    if (val) {
      this.setAttribute(&apos;time&apos;, val);
    } else {
      this.setAttribute(&apos;time&apos;, &apos;2s&apos;);
    }
  }

  /**
   * index getter
   */
  get index() {
    return this._index;
  }

  /**
   * index setter
   * @param {Number} v
   */
  set index(v) {
    this._index = v;
    // For looping
    if (this._index &gt;= this._imageChildCount) this.index = 0;
    if (this._index &lt; 0) this.index = Number(this._imageChildCount) - 1;
  }

  /**
   * start from a specific picture
   * @param {Number} index
   */
  _start(index) {
    if (this._interval !== undefined) {
      clearInterval(this._interval);
    }

    this._reRender(index);

    this.index = index;
    this._interval = setInterval(this._tick.bind(this), parseFloat(this.time) * 1000);
  }

  /**
   * tick function
   */
  _tick() {
    this.index = Number(this.index) + 1;
    this._reRender(this.index);
  }

  /**
   * @param {Number} index
   */
  _reRender(index) {
    Array.from(this._imageChildren).forEach((child) =&gt; {
      child.classList.add(&apos;hide&apos;);
    });
    this._imageChildren[index].classList.remove(&apos;hide&apos;);

    if (this.control &amp;&amp; this._menuItems !== null) {
      this._menuItems.forEach((item) =&gt; {
        item.removeAttribute(&apos;selected&apos;, &apos;&apos;);
      });
      this._menuItems[index].setAttribute(&apos;selected&apos;, &apos;&apos;);
    }
  }

  /**
   * _setUpControl
   * @param {*} oldV
   */
  _setUpControl(oldV) {
    // Set up control
    if (!this._controlInitialized) {
      this._initControl();
      this._controlInitialized = false;
    }

    if (this.control) {
      this._slider.appendChild(this._menu);
      this._slider.appendChild(this._leftArrow);
      this._slider.appendChild(this._rightArrow);
    } else if (oldV === &apos;&apos;) {
      this._slider.removeChild(this._slider.querySelector(&apos;#menu&apos;));
      this._slider.removeChild(this._slider.querySelector(&apos;#left-arrow&apos;));
      this._slider.removeChild(this._slider.querySelector(&apos;#right-arrow&apos;));
    }
  }
}

if (!customElements.get(&apos;core-slier&apos;)) {
  customElements.define(&apos;core-slider&apos;, coreSlider);
}

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
